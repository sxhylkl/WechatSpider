

Set-Cookie: black_passportid=1;
domain=.sogou.com; path=/;
expires=Thu, 01-Dec-1994 16:00:00 GMT

Set-Cookie: black_passportid=1;
domain=.sogou.com; path=/;
expires=Thu,01-Dec-1994 16:00:00 GMT


/********************1*********************/

'Cookie':{
'ABTEST':'6|1523333085|v1',
'IPLOC':'CN2101',
'SUID':'08DBA13D2113940A000000005ACC37DD',
'weixinIndexVisited':'1',
'SUV':'00C351E83DA1DB085ACC37DDD2319102',
'PHPSESSID':'r9qndiashb18e64pgjhpvggat5',
'SUIR':'1523333271',
'SNUID':'4F93E67548422E3EE37FEA1E488459A1',
'successCount':'1|Tue, 10 Apr 2018 04:13:03 GMT',
'JSESSIONID':'aaa6KiO2IZflJ6jvw7Siw;,
sct='3',
}

/********************2*********************/

Cookie:
ABTEST=6|1523333085|v1;
IPLOC=CN2101;
SUID=08DBA13D4631990A000000005ACC37DD;
SUID=08DBA13D2113940A000000005ACC37DD;
weixinIndexVisited=1;
SUV=00C351E83DA1DB085ACC37DDD2319102;
PHPSESSID=r9qndiashb18e64pgjhpvggat5;
SUIR=1523333271;
SNUID=4F93E67548422E3EE37FEA1E488459A1;
successCount=1|Tue, 10 Apr 2018 04:13:03 GMT;
JSESSIONID=aaa6KiO2IZflJ6jvw7Siw; sct=4---------------5-------6
/*****************************************/

Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3386.1 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8
/**/Referer: http://weixin.sogou.com/
Accept-Language: zh-CN,zh;q=0.9
Cookie: ABTEST=6|1523333085|v1; IPLOC=CN2101; SUID=08DBA13D4631990A000000005ACC37DD; SUID=08DBA13D2113940A000000005ACC37DD; weixinIndexVisited=1; SUV=00C351E83DA1DB085ACC37DDD2319102; PHPSESSID=r9qndiashb18e64pgjhpvggat5; SUIR=1523333271; SNUID=4F93E67548422E3EE37FEA1E488459A1; JSESSIONID=aaa6KiO2IZflJ6jvw7Siw; sct=6


Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3386.1 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8
/**/Referer: http://weixin.sogou.com/weixin?type=2&query=%E4%B8%AD%E5%9B%BD%E7%BB%8F%E7%BA%AA%E4%BA%BA&ie=utf8&s_from=input&_sug_=n&_sug_type_=1&w=01015002&oq=&ri=2&sourceid=sugg&sut=0&sst0=1523333697875&lkt=0%2C0%2C0&p=40040108
Accept-Language: zh-CN,zh;q=0.9
Cookie: ABTEST=6|1523333085|v1; IPLOC=CN2101; SUID=08DBA13D4631990A000000005ACC37DD; SUID=08DBA13D2113940A000000005ACC37DD; weixinIndexVisited=1; SUV=00C351E83DA1DB085ACC37DDD2319102; PHPSESSID=r9qndiashb18e64pgjhpvggat5; SUIR=1523333271; SNUID=4F93E67548422E3EE37FEA1E488459A1; JSESSIONID=aaa6KiO2IZflJ6jvw7Siw; sct=6



Referer: http://weixin.sogou.com/weixin?type=2&s_from=input&query=%E4%B8%AD%E5%9B%BD%E7%BB%8F%E7%BA%AA%E4%BA%BA&ie=utf8&_sug_=n&_sug_type_=



一、现象分析
1. 如果没有完全模拟浏览器，会在访问数页之后进入 antispider 页面要求输入验证码
2. 复制当前浏览器 cookies 后，可以访问更多页数，但一段时间后还是会触发验证码
3. 清理该 cookies 后无需验证码又可以访问
4. 此系统属于搜狗平台化运维体系 http://wenku.baidu.com/view/1fa63e39b90d6c85ec3ac6c5.html

二、两处 cookies 注入点
1. 访问首页注入 cookie SUID 标识了一次会话
2. antispider 页面有两种类型，第一次触发时仅仅使用 javascript 注入 cookies SNUID ，表示此次访问的不是 spider ；第二次触发后显示验证码，但是只要重新访问首页获取新的 SUID ，就可以避免验证码识别或者更换 IP
3. 自行拼接参数发送请求，可能导致嫌疑程度增加
4. user-agent 含 spider/bot 的具有重大作案嫌疑，触发时直接返回 403

三、反屏蔽机制——尽量模拟浏览器
1. 涉及 cookies 注入的图片和网页都访问一遍
2. 使用 javascript 注入的 cookies 全部抓取一遍并 setCookie
3. 如果 antispider 页面（ http://www.sogou.com/antispider/） 出现验证码，清理旧 cookies ，重新发起请求